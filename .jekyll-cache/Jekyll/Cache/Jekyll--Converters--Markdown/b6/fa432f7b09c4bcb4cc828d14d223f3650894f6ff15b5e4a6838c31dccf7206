I"p<p align="center"><img src="/images/post_img/mongodb1.png" /></p>

<h2 id="1-flexibly-structured-data">1. Flexibly Structured Data</h2>

<p>MongoDBëŠ” ì—„ê²©í•˜ê³  ì•Œë ¤ì§„ êµ¬ì¡° ì—†ì´ ë°ì´í„°ë¥¼ íƒìƒ‰í•˜ëŠ” ë° ë„ì›€ì„ ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.</p>

<p>ì´ë¥¼ ì´ìš©í•´, ë‹¤ì–‘í•œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³ , ë¶„ì„ ë° í†µí•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë˜í•œ ìš”êµ¬ ì‚¬í•­ì´ ë°œì „í•¨ì— ë”°ë¼ ë¬¸ì œë¥¼ ê³„ì† ê°œì„ í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì˜¤ëŠ˜ë‚  ì›¹ìƒì˜ ëŒ€ë¶€ë¶„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤ëŠ” íŠ¹ì • ë°ì´í„° í˜•ì‹ì„ ë…¸ì¶œí•˜ëŠ”ë°, ì´ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆìœ¼ë©´ MongoDBë¥¼ ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="javascript-object-notation--json-">JavaScript Object Notation ( JSON )</h4>

<ul>
  <li>JSONì€ ì›¹ì„œë¹„ìŠ¤ì™€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œê°€ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì¼ë°˜ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.</li>
  <li>JSONì€ MongoDB ë°ì´í„° í˜•ì‹ì˜ ê¸°ì´ˆì…ë‹ˆë‹¤.</li>
  <li>JSONì€ ë‘ê°€ì§€ ì»¬ë ‰ì…˜ êµ¬ì¡°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.
    <ul>
      <li>Objects {}</li>
      <li>Arrays []</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h4 id="json--python">JSON &lt;&gt; Python</h4>

<ul>
  <li>JSON ê°ì²´ëŠ” Pythonì— ìˆëŠ” <strong>dictionary</strong> í˜•ì‹ê³¼ ê°™ìŠµë‹ˆë‹¤.</li>
  <li>Arrayë˜í•œ, Python <strong>Array</strong>ì™€ ë™ì¼í•©ë‹ˆë‹¤.</li>
  <li>strings, numbers, boolean, null ë“±ì´ íŒŒì´ì¬ì—ì„œë„ ë§¤í•‘ë©ë‹ˆë‹¤.</li>
</ul>

<p><br /></p>

<h4 id="json--python--mongodb">JSON &lt;&gt; Python &lt;&gt; MongoDB</h4>

<table>
  <thead>
    <tr>
      <th>MongoDB</th>
      <th>JSON</th>
      <th>Python</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Databases</td>
      <td>Objects</td>
      <td>Dictionaries</td>
    </tr>
    <tr>
      <td>&gt; Collections</td>
      <td>Arrays</td>
      <td>Lists</td>
    </tr>
    <tr>
      <td>Â» Documents</td>
      <td>Objects</td>
      <td>Dictionaries</td>
    </tr>
    <tr>
      <td>Â»&gt; Subdocuments</td>
      <td>Objects</td>
      <td>Dictionaries</td>
    </tr>
    <tr>
      <td>Â»&gt; Values</td>
      <td>Value types</td>
      <td>Value types + datetim, regex</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h4 id="example-the-nobel-prize-api-database">Example) The Nobel Prize API data(base)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClinet</span><span class="p">()</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">clinet</span><span class="p">[</span><span class="s">'nobel'</span><span class="p">]</span>

<span class="k">for</span> <span class="n">collection_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'prizes'</span><span class="p">,</span> <span class="s">'laureates'</span><span class="p">]:</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://api.nobelprize.org/v1/{}.json"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">collection_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
  <span class="n">documents</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="n">collection_name</span><span class="p">]</span>
  <span class="n">db</span><span class="p">[</span><span class="n">collection_name</span><span class="p">].</span><span class="n">insert_many</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>pymongo ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´, íŒŒì´ì¬ìœ¼ë¡œ MongoDBë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´í›„ clientë¥¼ ì„ ì–¸í•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•©ë‹ˆë‹¤.</p>

<p>ë°˜ë³µë¬¸ì„ í†µí•´ì„œ, ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="ì»¬ë ‰ì…˜ì—ì„œ-ë¬¸ì„œë¥¼-ê³„ì‚°í•˜ëŠ”-ë°©ë²•--ë¬¸ì„œë¥¼-ì°¾ëŠ”-ë°©ë²•">ì»¬ë ‰ì…˜ì—ì„œ ë¬¸ì„œë¥¼ ê³„ì‚°í•˜ëŠ” ë°©ë²• &amp; ë¬¸ì„œë¥¼ ì°¾ëŠ” ë°©ë²•</h4>

<p>ë¨¼ì € í´ë¼ì´ì–¸íŠ¸ ê°œì²´ì—ì„œ ë°ì´í„° ë² ì´ìŠ¤ ë° ì»¬ë ‰ì…˜ ì•¡ì„¸ìŠ¤ í•©ë‹ˆë‹¤.</p>

<ul>
  <li>Using <strong>[]</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s">"nobel"</span><span class="p">]</span>
<span class="n">prizes_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s">"prizes"</span><span class="p">]</span>
</code></pre></div></div>

<p><br /></p>

<ul>
  <li>Using <strong>.</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">nobel</span>
<span class="n">prizes_collection</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s">"prizes"</span><span class="p">]</span>
</code></pre></div></div>

<p>ë‘ê°€ì§€ ë°©ë²•ì¤‘ ìµìˆ™í•œ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="count-documents">Count documents</h4>

<p>ë¬¸ì„œì˜ ìˆ˜ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ì„œëŠ” <strong>count_documents</strong> ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">filter</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">n_prizes</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">count_documents</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
<span class="n">n_laureates</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
</code></pre></div></div>

<p>í•„í„°ë¥¼ í†µí•´ì„œ, í•„í„°ë§ í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">doc</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find_one</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
</code></pre></div></div>

<p>ì´í›„, ë¬¸ì„œë¥¼ ê°€ì ¸ì™€ APIê°€ ì œê³µí•˜ëŠ” ì›ì‹œ JSON ë°ì´í„°ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ìœ ì¶”í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="ë¬¸ì„œ-ì°¾ê¸°">ë¬¸ì„œ ì°¾ê¸°</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter_doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'born'</span> <span class="p">:</span> <span class="s">'1845-03-27'</span><span class="p">,</span>
  <span class="s">'diedCountry'</span> <span class="p">:</span> <span class="s">'Germany'</span><span class="p">,</span>
  <span class="s">'gender'</span> <span class="p">:</span> <span class="s">'male'</span><span class="p">,</span>
  <span class="s">'surname'</span> <span class="p">:</span> <span class="s">'Rontgen'</span>
<span class="p">}</span>

<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">filter_doc</span><span class="p">)</span>
</code></pre></div></div>

<p>ë¬¸ì„œë¥¼ ì°¾ê¸° ìœ„í•´ì„œëŠ”, ì°¾ê³ ìí•˜ëŠ” ë¬¸ì„œì˜ ì •ë³´ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤.</p>

<p>ì´í›„, <strong>count_documents</strong> ë¥¼ í†µí•´, í•´ë‹¹í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="simple-filters">Simple filters</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">'gender'</span><span class="p">:</span><span class="s">'female'</span><span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, ë‹¨ì¼ í•„í„°ë¥¼ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="composing-filters">Composing filters</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter_doc</span> <span class="o">=</span> <span class="p">{</span><span class="s">'gender'</span><span class="p">:</span><span class="s">'female'</span><span class="p">,</span>
             <span class="s">'diedCountry'</span> <span class="p">:</span> <span class="s">'France'</span><span class="p">,</span>
             <span class="s">'bornCity'</span> <span class="p">:</span> <span class="s">'Warsaw'</span><span class="p">}</span>
<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">filter_doc</span><span class="p">)</span>
</code></pre></div></div>

<p>ë°ì´í„°ì— ëŒ€í•œ ë‚´ìš©ì„ ë³´ê³  ì‹¶ìœ¼ë©´,  <strong>find_one</strong> ì„ í†µí•´ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ( ëª¨ë‘ ê°€ì ¸ì˜¤ë ¤ë©´, <strong>find</strong> )</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">filter_doc</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="query-operators">Query operators</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span>
  <span class="s">'diedCountry'</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s">'$in'</span> <span class="p">:</span> <span class="p">[</span><span class="s">'France'</span><span class="p">,</span> <span class="s">'USA'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span>
  <span class="s">'diedCountry'</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s">'$ne'</span> <span class="p">:</span><span class="s">'France'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ì™€ê°™ì´, í•„ë“œê°€ â€˜Franceâ€™ ì´ê±°ë‚˜ â€˜USAâ€™ ì¸ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>MongoDB ì—°ì‚°ìì—ëŠ” ë‹¬ëŸ¬ê¸°í˜¸ ì ‘ë‘ì‚¬ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p>

<p>ë˜í•œ, íŠ¹ì • ë¬¸ìì—´ê³¼ ê°™ì§€ ì•Šì€ ë¬¸ì„œë¥¼ ì°¾ìœ¼ë ¤ë©´, <strong>â€˜$neâ€™</strong> ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<ul>
  <li><strong>$gt</strong>  : &gt;</li>
  <li><strong>$gte</strong>  : &gt;=</li>
  <li><strong>$lt</strong>  : &lt;</li>
  <li><strong>$lte</strong>  : &lt;=</li>
</ul>

<p>ì´ì™¸ì—ë„ ìœ„ì™€ ê°™ì€ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span>
  <span class="s">'diedCountry'</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">'$gt'</span> <span class="p">:</span> <span class="s">'Belgium'</span><span class="p">,</span>
    <span class="s">'$lte'</span> <span class="p">:</span> <span class="s">'USA'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, ë¬¸ìì—´ì„ ì…ë ¥í–ˆì„ ê²½ìš°, ìˆ«ìê°€ ì•„ë‹Œ ì•ŒíŒŒë²³ ìˆœì„œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="a-functional-density">A functional density</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">({</span>
  <span class="s">"firstname"</span><span class="p">:</span> <span class="s">"Walter"</span><span class="p">,</span>
  <span class="s">'surname'</span><span class="p">:</span> <span class="s">"Kohn"</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ëŠ” <strong>find_one</strong> ë¥¼ ì´ìš©í•´ì„œ ê²€ìƒ‰í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>

<p align="center"><img src="/images/post_img/mongodb2.png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span>
	<span class="s">"prizes.affiliations.name"</span> <span class="p">:</span> <span class="p">(</span><span class="s">"University of California"</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ì˜ ì•„ì›ƒí’‹ì—ì„œ, affiliations.name ì— í•´ë‹¹í•˜ëŠ” ê²°ê³¼ê°’ì„ ê°€ì§„ ë¬¸ì„œì˜ ê°¯ìˆ˜ë¥¼ ì°¾ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>

<p>ì í‘œê¸°ë²•ì„ í†µí•´ì„œ, ë¬¸ì„œì „ì²´ì—ì„œ ì´ì— í•´ë‹¹í•˜ëŠ” ë¬¸ì„œê°€ ëª‡ê°œì¸ì§€ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="schema">Schema</h4>

<p>MongoDBë¥¼ ì‚¬ìš©í•˜ë©´, ì»¬ë ‰ì…˜ì— ëŒ€í•œ ìŠ¤í‚¤ë§ˆë¥¼ ì§€ì •í•˜ê³  ì ìš©í•  ìˆ˜ ìˆì§€ë§Œ, í•„ìˆ˜ëŠ” ì•„ë‹™ë‹ˆë‹¤.</p>

<p>ì˜ˆë¥¼ë“¤ì–´, í•„ë“œëŠ”, ì»¬ë ‰ì…˜ì˜ ë¬¸ì„œì—ì„œ ë™ì¼í•œ ìœ í˜•ì˜ ê°’ì„ ê°€ì§ˆ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">'surname'</span><span class="p">:</span> <span class="s">'Naipaul'</span><span class="p">})</span>
</code></pre></div></div>

<p align="center"><img src="/images/post_img/mongodb3.png" /></p>

<p>ìœ„ì™€ ê°™ì´, pirzes ë¶€ë¶„ì´ ë¹„ì–´ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë£¨íŠ¸ ìˆ˜ì¤€ í•„ë“œë¼ë„ ëª¨ë“  ë¬¸ì„œì— ìˆì„ í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ìœ„ì˜ ì¶œë ¥ì˜ ì˜ˆì‹œì—ì„œëŠ” bornCountryê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
</code></pre></div></div>

<p><strong>â€œ$existsâ€</strong> ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´, í•„ë“œì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ì¿¼ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({})</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">922</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">'prizes'</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">922</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">'prizes.0'</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">922</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">'prizes.1'</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">6</span>
</code></pre></div></div>

<p>ìœ„ì™€ê°™ì´, .0 .1 ë“±ìœ¼ë¡œ, í•´ë‹¹í•˜ëŠ” ìˆ«ìë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="2-working-with-distinct-values-and-sets">2. Working with Distinct Values and Sets</h2>

<p><br /></p>

<h4 id="using-distinct">Using <strong>.distinct()</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"gender"</span><span class="p">)</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'male'</span><span class="p">,</span> <span class="s">'female'</span><span class="p">,</span> <span class="s">'org'</span><span class="p">]</span>
</code></pre></div></div>

<p>distinctë¥¼ ì´ìš©í•´ì„œ, ìœ ë‹ˆí¬í•œ ê°’ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì§‘ê³„ëŠ” ì»¬ë ‰ì…˜ ì „ì²´ì—ì„œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³ , ê³„ì‚°ëœ ê²°ê³¼ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="index">Index</h4>

<p>MongoDBê°€ ìœ ì§€ê´€ë¦¬í•  í•„ë“œì— Indexë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ”ë°, ì´ë¥¼ ì´ìš©í•´ì„œ, íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ ë° ì§‘ê³„ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ, ë§ì€ ë°ì´í„°ë¡œ ì‘ì—…í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ì¼ë°˜ì ìœ¼ë¡œ Indexê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ( ì‚¬ìš©í•˜ëŠ” ì»¬ë ‰ì…˜ì´ ë©”ëª¨ë¦¬ì— ë‚¨ê¸°ë•Œë¬¸ì— - ë©”ê°€ë°”ì´íŠ¸ ë¯¸ë§Œ, ì²œê°œì´í•˜ì˜ ë¬¸ì„œ )</p>

<p><br /></p>

<h4 id="distinct-with-dot-notation">.distinct() with dot notation</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">"prizes.2"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
</code></pre></div></div>

<p>ì í‘œê¸°ë²•ì„ ì‚¬ìš©í•˜ë©´, ë¬¸ì„œì˜ ë£¨íŠ¸ ìˆ˜ì¤€ë³´ë‹¤ ê¹Šì´ í¬í•¨ëœ í•„ë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">"prizes.share"</span><span class="p">:</span> <span class="s">"4"</span><span class="p">})</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, ì  í‘œê¸°ë²•ìœ¼ë¡œ, ì°¾ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"prizes.category"</span><span class="p">)</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'physics'</span><span class="p">,</span> <span class="s">'chemistry'</span><span class="p">,</span> <span class="s">'peace'</span><span class="p">,</span>
<span class="s">'medicine'</span><span class="p">,</span><span class="s">'literature'</span><span class="p">,</span> <span class="s">'econmics'</span><span class="p">]</span>

<span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"prizes.share"</span><span class="p">:</span> <span class="s">"4"</span><span class="p">}))</span>
</code></pre></div></div>

<p>ìœ„ì™€ê°™ì´ ë‘ê°œì˜ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©í•´ì„œ í•©ì¹˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, ì´ë¥¼ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ì‚¬ìš©í•˜ë©´ ë” ê¹”ê¸ˆí•˜ê²Œ ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"prizes.category"</span><span class="p">,</span> <span class="p">{</span><span class="s">"prizes.share"</span><span class="p">:</span> <span class="s">"4"</span><span class="p">})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'physics'</span><span class="p">,</span> <span class="s">'chemistry'</span><span class="p">,</span> <span class="s">'medicine'</span><span class="p">]</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, distinctí•¨ìˆ˜ì— ì¸ìë¥¼ ë„£ì–´ì£¼ë©´, í•´ë‹¹í•˜ëŠ” ì¹´í…Œê³ ë¦¬ë§Œ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="example-prize-categories-with-multi-winners">Example) prize categories with multi-winners</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"prizes.1"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>
</code></pre></div></div>

<p><br /></p>

<p>ë‘ ê°œ ì´ìƒì˜ prizesë¥¼ ìˆ˜ìƒí•œ ìˆ˜ìƒìê°€ ìˆëŠ” ìƒì˜ ì¹´í…Œê³ ë¦¬ ìˆ˜ë¥¼ ì°¾ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"prizes.category"</span><span class="p">,</span> <span class="p">{</span><span class="s">"prizes.1"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$exists"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'chemistry'</span><span class="p">,</span> <span class="s">'physics'</span><span class="p">,</span> <span class="s">'peace'</span><span class="p">]</span>
</code></pre></div></div>

<p>distinctë¥¼ ì´ìš©í•´ì„œ, ìƒì„ 2ë²ˆì´ìƒ ë°›ì€ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶œë ¥í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="array-fields-and-equality-simplified">Array fields and equality, simplified</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s">"nicknames"</span> <span class="p">:</span> <span class="p">[</span><span class="s">"Johnny"</span><span class="p">,</span> <span class="s">"JSwitch"</span><span class="p">,</span> <span class="s">"JB"</span><span class="p">,</span> <span class="s">"Tc Johnny"</span><span class="p">,</span> <span class="s">"Bardy"</span><span class="p">]}</span>

<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"nicknames"</span><span class="p">:</span> <span class="s">"JB"</span><span class="p">})</span>
</code></pre></div></div>

<p>JBë¼ëŠ” ë³„ëª…ì„ ê°€ì§„ ëª¨ë“  ìˆ˜ìƒìë¥¼ ì°¾ëŠ”ë‹¤ê³  ê°€ì •í•  ë•Œ,  ìœ„ì™€ ê°™ì´, í•„í„° ë¬¸ì„œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>í•„í„°ëŠ” â€œnicknamesâ€ ë°°ì—´ í•„ë“œì— â€œJBâ€ ì™€ ë™ì¼í•œ ê°’ì´ í•˜ë‚˜ ì´ìƒ ìˆëŠ” ëª¨ë“  ë¬¸ì„œì™€ ì¼ì¹˜ì‹œí‚µë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="array-fields-and-operators">Array fields and operators</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"prizes.category"</span><span class="p">:</span> <span class="s">"physics"</span><span class="p">})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">206</span>

<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"prizes.category"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$ne"</span><span class="p">:</span> <span class="s">"physics"</span><span class="p">}})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">716</span>
</code></pre></div></div>

<p>ë™ì¼í•˜ê²Œ, â€œ$neâ€ë¥¼ í†µí•´ì„œ, physicsë¥¼ ìˆ˜ìƒí•˜ì§€ ì•Šì€ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"prizes.category"</span><span class="p">:</span> 
                              <span class="p">{</span><span class="s">"$in"</span> <span class="p">:</span> <span class="p">[</span><span class="s">"physics"</span><span class="p">,</span> <span class="s">"chemistry"</span><span class="p">,</span> <span class="s">"medicine"</span><span class="p">]}})</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">596</span>

<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s">"prizes.category"</span><span class="p">:</span> 
                              <span class="p">{</span><span class="s">"$nin"</span> <span class="p">:</span> <span class="p">[</span><span class="s">"physics"</span><span class="p">,</span> <span class="s">"chemistry"</span><span class="p">,</span> <span class="s">"medicine"</span><span class="p">]}})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">326</span>
</code></pre></div></div>

<p>ë˜í•œ, not-in ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬, í•´ë‹¹ ë²”ì£¼ì— ì†í•˜ì§€ ì•ŠëŠ” ì ì–´ë„ í•˜ë‚˜ì˜ ìƒì„ ê°€ì§„ ìˆ˜ìƒìë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="enter-elemmatch">Enter $elemMatch</h4>

<p>ìƒí’ˆ í•˜ìœ„ ë¬¸ì„œ ë‚´ì—ì„œ, ë‘˜ ì´ìƒì˜ í•„ë“œë¥¼ í•„í„°ë§ í•˜ê¸° ìœ„í•´ì„œëŠ”, $elemMatchë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">count_documents</span><span class="p">({</span>
  <span class="s">"prizes"</span><span class="p">:</span> <span class="p">{</span><span class="s">"elemMatch"</span><span class="p">:{</span><span class="s">"category"</span><span class="p">:</span> <span class="s">"physics"</span><span class="p">,</span> <span class="s">"share"</span><span class="p">:</span><span class="s">"1"</span><span class="p">}}})</span>
</code></pre></div></div>

<p>elemMatch ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´, í•´ë‹¹ ì¡°ê±´ ëª¨ë‘ í•´ë‹¹í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="finding-a-substring-with-regex">Finding a substring with $regex</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">"firstname"</span><span class="p">:</span> <span class="s">"Marie"</span><span class="p">})</span>
</code></pre></div></div>

<p align="center"><img src="/images/post_img/mongodb4.png" /></p>

<p>ìœ„ì™€ ê°™ì€ ì¶œë ¥ì—ì„œ, bornCountry ì† Poland ë¥¼ ê°€ì§€ëŠ” ë¬¸ì„œë¥¼ ì¶œë ¥í•˜ê³  ì‹¶ì„ë•Œ, regexë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$regex"</span><span class="p">:</span> <span class="s">"Poland"</span><span class="p">}})</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, í´ë€ë“œ ë¬¸ìì—´ì— ì •ê·œì‹ ì—°ì‚°ìë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p align="center"><img src="/images/post_img/mongodb5.png" /></p>

<p>ìœ„ì™€ ê°™ì´, í´ë€ë“œë¥¼ í¬í•¨í•œ ë¬¸ì„œë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="flag-options-for-regular-expressions">Flag options for regular expressions</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$regex"</span><span class="p">:</span> <span class="s">"poland"</span><span class="p">,</span> <span class="s">"$options"</span><span class="p">:</span><span class="s">"i"</span><span class="p">}})</span>
</code></pre></div></div>

<p>ë‹¤ìŒê³¼ ê°™ì´ optionì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤. ( ì˜µì…˜ iëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ” ë°©ë²•ì…ë‹ˆë‹¤. )</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bson.regex</span> <span class="kn">import</span> <span class="n">Regex</span>
<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="n">Regex</span><span class="p">(</span><span class="s">"poland"</span><span class="p">,</span> <span class="n">i</span><span class="p">)})</span>
</code></pre></div></div>

<p>MongoDBëŠ” ë˜í•œ ì»´íŒŒì¼ëœ ì •ê·œì‹ ê°œì²´ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</p>

<p>Pymongo ë“œë¼ì´ë²„ì—ëŠ” bson Regex í´ë˜ìŠ¤ê°€ ìˆëŠ” íŒ¨í‚¤ì§€ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ íŒ¨í‚¤ì§€ëŠ” í‘œì‹œëœ ëŒ€ë¡œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>
<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"poland"</span><span class="p">)})</span>
</code></pre></div></div>

<p>Python ì •ê·œì‹ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, bson Regex í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ MongoDBì— ë” ì í•©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="begining-and-ending--and-escaping-">Begining and ending ( and escaping )</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">bson.regex</span> <span class="kn">import</span> <span class="n">Regex</span>
<span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="n">Regex</span><span class="p">(</span><span class="s">"^Poland"</span><span class="p">)})</span>

<span class="p">[</span><span class="s">'output'</span><span class="p">]</span>
<span class="p">[</span><span class="s">'Poland'</span><span class="p">,</span>
<span class="s">'Poland (now Ukraine)'</span><span class="p">,</span>
<span class="p">...</span>
</code></pre></div></div>

<p>í•„ë“œ ê°’ì˜ ì‹œì‘ ë¶€ë¶„ê³¼ ì¼ì¹˜ì‹œí‚¤ë ¤ë©´, ìºëŸ¿ ë¬¸ì(^)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. - regexì— ì „ë‹¬í•˜ëŠ” ë¬¸ìì—´ì˜ ì‹œì‘ ë¶€ë¶„ì— ê³ ì •ì‹œí‚µë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="n">Regex</span><span class="p">(</span><span class="s">"^Poland \(now"</span><span class="p">)})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'Poland (now Ukraine)'</span><span class="p">,</span>
<span class="s">'Poland (now Lithuania)'</span><span class="p">,</span>
<span class="p">...</span>
</code></pre></div></div>

<p>ë¬¸ìë¥¼ ì´ìŠ¤ì¼€ì´í”„ í•˜ë ¤ë©´, ë°±ìŠ¬ë˜ì‹œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="n">Regex</span><span class="p">(</span><span class="s">"now Poland\)$"</span><span class="p">)})</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[</span><span class="s">'Russian Empire (now Poland)'</span><span class="p">,</span>
<span class="s">'Prussia (now Poland)'</span><span class="p">,</span>
<span class="p">...</span>
</code></pre></div></div>

<p>í•„ë“œ ê°’ì˜ ëì„ ì¼ì¹˜ ì‹œí‚¤ë ¤ë©´ ë‹¬ëŸ¬ ê¸°í˜¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="3-get-only-what-you-need-and-fast">3. Get Only What You Need, and Fast</h2>

<p><br /></p>

<h4 id="projection-ì´ë€">Projection ì´ë€?</h4>

<p>Projectionì´ë¼ëŠ” ìš©ì–´ëŠ” ë‹¤ì°¨ì› ë°ì´í„°ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì— ê´€í•œ ê²ƒì…ë‹ˆë‹¤.</p>

<p>ë°ì´í„° í…Œì´ë¸” ì—´ì„ ì„ íƒí•˜ëŠ” ê²ƒì¸ë°, MongoDBì—ì„œëŠ” í•˜ìœ„ êµ¬ì¡°ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="projection-in-mongodb">Projection in MongoDB</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="p">{},</span> <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s">"prizes.affilations"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="s">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="nb">type</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">pymongo</span><span class="p">.</span><span class="n">cursor</span><span class="p">,</span><span class="n">Cursor</span> <span class="k">as</span> <span class="mh">0x10d6e69e8</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>MongoDBì—ì„œëŠ” ë¬¸ì„œ í•„ë“œë¥¼ ì§€ì •í•˜ì—¬ ì˜ˆì¸¡ ê°’ë“¤ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

<p>ì»¬ë ‰ì…˜ì˜ find ë©”ì„œë“œì— ëŒ€í•œ ë‘ë²ˆì§¸ ì¸ìˆ˜ë¡œ ì‚¬ì „ì„ ì „ë‹¬í•˜ì—¬, ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>íˆ¬ì˜ì— í¬í•¨í•˜ë ¤ëŠ” ê° í•„ë“œì— ëŒ€í•´ ê°’ 1ì„ ì§€ì •í•©ë‹ˆë‹¤. í¬í•¨í•˜ì§€ ì•Šì€ í•„ë“œëŠ” íˆ¬ì˜ì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p>ë‹¨ â€œ_idâ€ í•„ë“œëŠ” ì˜ˆì™¸ì‚¬í•­ìœ¼ë¡œ, ê¸°ë³¸ì ìœ¼ë¡œ í•­ìƒ íˆ¬ì˜ì— í¬í•¨ë©ë‹ˆë‹¤. ì´ë¥¼ ìƒëµí•˜ë ¤ë©´ 0ì„ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>í•´ë‹¹ ë¦¬í„´ê°’ì€, ë°ì´í„° ìì²´ê°€ì•„ë‹ˆë¼ ì»¤ì„œë¡œ, í•œë²ˆì— í•˜ë‚˜ì”© ë¬¸ìë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ì´í„°ëŸ¬ë¸” í˜•íƒœì…ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">docs</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>ìš°ë¦¬ëŠ” ì´ë ‡ê²Œ ì–»ì€ ì´í„°ëŸ¬ë¸”ì— Listë¥¼ ì·¨í•¨ìœ¼ë¡œì¨, ë°ì´í„°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="missing-fields">Missing fields</h4>

<p>ë§Œì•½ findí•œ ë‚´ìš©ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ì¼ ê²½ìš°, MongoDBëŠ” ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ëŒ€ì‹ , í•´ë‹¹ í•„ë“œê°€ ì—†ëŠ” ë¬¸ì„œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="simple-aggregation">Simple aggregation</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find</span><span class="p">({},</span> <span class="p">[</span><span class="s">"prizes"</span><span class="p">])</span>

<span class="n">n_prizes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
  <span class="n">n_prizes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s">"prizes"</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">n_prizes</span><span class="p">)</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="mi">942</span>
</code></pre></div></div>

<p>ì˜ˆë¥¼ ë“¤ì–´, ìˆ˜ì—¬ëœ ì´ ìƒê¸ˆ ë©”ë‹¬ ìˆ˜ë¥¼ ê³„ì‚°í•œë‹¤ê³  í•  ë•Œ, ëª¨ë“  ìˆ˜ìƒìì— ëŒ€í•œ ìƒí’ˆ ë°°ì—´ì˜ ì´ ìš”ì†Œ ìˆ˜ë¥¼ ì–»ìŠµë‹ˆë‹¤.</p>

<p>ìœ„ì™€ ê°™ì´, prizesë§Œ íˆ¬ì˜í•´, ë§¤ìš° í° ì»¬ë ‰ì…˜ì˜ ì„±ëŠ¥ì— í™•ì‹¤íˆ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="sorting-post-query-with-python">Sorting post-query with Python</h4>

<p>Pythonë§Œìœ¼ë¡œ ê²€ìƒ‰ëœ ë¬¸ì„œ ëª©ë¡ì„ ì •ë ¬í•˜ëŠ” ë°©ë²•ì€ ìœ ìš©í•©ë‹ˆë‹¤.</p>

<p>ì´ ë°©ë²•ì€, íŠ¹íˆ ì‘ì€ ë°ì´í„° ì„¸íŠ¸ì˜ ê²½ìš° ì„±ëŠ¥ì´ ë›°ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´ëŠ” ë°ì´í„°ë¥¼ ë¡œì»¬ ìºì‹œì— ì €ì¥í•˜ê³ , ë‹¤ì–‘í•œ ì‘ì—…ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"category"</span><span class="p">:</span> <span class="s">"physics"</span><span class="p">},</span> <span class="p">[</span><span class="s">"year"</span><span class="p">]))</span>

<span class="n">docs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s">"year"</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="s">"year"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</code></pre></div></div>

<p>íŒŒì´ì¬ sortedí•¨ìˆ˜ì— keyë¡œ itemgetter(â€œyearâ€) ë¥¼ í†µí•´, ì •ë ¬í•˜ë©´, yearìˆœìœ¼ë¡œ ì •ë ¬ëœ ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="sorting-in-query-with-mongodb">Sorting in-query with MongoDB</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"category"</span><span class="p">:</span> <span class="s">"physics"</span><span class="p">},</span> <span class="p">[</span><span class="s">"year"</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
<span class="k">print</span><span class="p">([</span><span class="n">doc</span><span class="p">[</span><span class="s">"year"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>

<span class="s">'''
ì—­ìˆœì˜ ê°’ì„ ì–»ê³  ì‹¶ìœ¼ë©´, sortì— -1ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤..
cursor = db.prizes.find({"category": "physics"}, ["year"], sort=[("year",-1)])
'''</span>
</code></pre></div></div>

<p>Mongoì— ì„œë²„ì˜ í•„ë“œ ê°’ìœ¼ë¡œ ê°„ë‹¨í•œ ì •ë ¬ì„ ìˆ˜í–‰í•˜ê³ , ê²°ê³¼ë¥¼ ì •ë ¬ëœ ìˆœì„œë¡œ ìš”ì²­í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="primary-and-secondary-sorting">Primary and secondary sorting</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"year"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$gt"</span><span class="p">:</span> <span class="s">"1966"</span><span class="p">,</span> <span class="s">"$lt"</span> <span class="p">:</span> <span class="s">"1970"</span><span class="p">}},</span> <span class="p">[</span><span class="s">"category"</span><span class="p">,</span> <span class="s">"year"</span><span class="p">],</span>
  			<span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">"year"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">"category"</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
	<span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ì •ë ¬ì„ ìœ„í•´, ë‘ê°œì˜ í‚¤ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì€, sortì— 2ê°œì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="sorting-with-pymongo-versus-mongodb-shell">Sorting with pymongo versus MongoDB shell</h4>

<p>MongoDBìš© CLI shellì€ JavaScriptë¥¼ ì´ìš©í•©ë‹ˆë‹¤.</p>

<ul>
  <li>MongoDB shell
    <ul>
      <li>{â€œyearâ€: 1, â€œcategoryâ€:-1}</li>
      <li>javascript ê°œì²´ëŠ” ì…ë ¥ëœ í‚¤ ìˆœì„œë¡œ ìœ ì§€ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>Python
    <ul>
      <li>Python 3.6 ì´í•˜ì˜ ë²„ì „ì—ì„œëŠ”, ê°œì²´ ìˆœì„œë¥¼ ìœ ì§€í•œë‹¤ëŠ” ë³´ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</li>
      <li>ì´ê²ƒì´ pymongoì— íŠœí”Œ ëª©ë¡ì´ í•„ìš”í•œ ì´ìœ ì…ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h4 id="index-1">Index</h4>

<p>MongoDBì˜ ì¸ë±ìŠ¤ëŠ” ì±…ì˜ ì¸ë±ìŠ¤ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<p>MongoDBë¥¼ ì‚¬ìš©í•˜ë©´ ê° ì»¬ë ‰ì…˜ì„ ì±…ìœ¼ë¡œ, ê° ë¬¸ì„œë¥¼ í˜ì´ì§€ë¡œ, ê° í•„ë“œë¥¼ ì½˜í…ì¸  ìœ í˜•ìœ¼ë¡œ ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<p>ì¸ë±ìŠ¤ë¥¼ í†µí•´, í•´ë‹¹ í•„ë“œì˜ ê°’ì„ ì‚¬ìš©í•˜ì—¬ í•„ë“œë¥¼ ì¸ë±ì‹± í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="when-to-use-indexes">When to use indexes?</h4>

<ul>
  <li>í•˜ë‚˜ ë˜ëŠ” ëª‡ ê°œì˜ ë¬¸ì„œë§Œ ëŒë ¤ë°›ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ëŠ” ê²½ìš°</li>
  <li>ë¬¸ì„œê°€ ë§¤ìš° í¬ê±°ë‚˜ ì»¬ë ‰ì…˜ì´ ë§¤ìš° í° ê²½ìš°</li>
</ul>

<p><br /></p>

<h4 id="íŠ¹ì •-ì¿¼ë¦¬ë¥¼-ì‚¬ìš©í•˜ì—¬-ìƒí’ˆ-ë¬¸ì„œë¥¼-ìˆ˜ì§‘í•˜ëŠ”ë°-ê±¸ë¦¬ëŠ”-ì‹œê°„">íŠ¹ì • ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒí’ˆ ë¬¸ì„œë¥¼ ìˆ˜ì§‘í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"year"</span><span class="p">:</span><span class="s">"1901"</span><span class="p">}))</span>

<span class="mf">0.5</span> <span class="n">ë°€ë¦¬ì´ˆ</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({},</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="mi">5</span> <span class="n">ë°€ë¦¬ì´ˆ</span>
</code></pre></div></div>

<p><br /></p>

<h4 id="adding-a-single-field-index">Adding a single-field index</h4>

<p><strong>create_index</strong> ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ìƒ ì—°ë„ì— ëŒ€í•œ ì˜¤ë¦„ì°¨ìˆœ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
</code></pre></div></div>

<p><br /></p>

<p>ì´ë¥¼ ìƒì„±í•˜ê³ , ìœ„ì—ì„œ í–ˆë˜ ì‹œê°„ ì¸¡ì •ì„ í• ê²½ìš°, ì¿¼ë¦¬ ì„±ëŠ¥ì´ í–¥ìƒë¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"year"</span><span class="p">:</span><span class="s">"1901"</span><span class="p">}))</span>

<span class="mf">0.38</span> <span class="n">ë°€ë¦¬ì´ˆ</span>
</code></pre></div></div>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span><span class="n">timeit</span>
<span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({},</span> <span class="n">sort</span><span class="o">=</span><span class="p">[(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="mi">4</span> <span class="n">ë°€ë¦¬ì´ˆ</span>
</code></pre></div></div>

<p>ë‹¨ì¼ì¿¼ë¦¬ì—ì„œ 30% ë³µìˆ˜ì¿¼ë¦¬ì—ì„œ 20%ì˜ ì„±ëŠ¥í–¥ìƒì„ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="adding-a-compoundmultiple-field-index">Adding a compound(multiple-field) index</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s">"category"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
</code></pre></div></div>

<p>ì˜¤ë¦„ì°¨ìˆœ ë²”ì£¼ì— ëŒ€í•œ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ë§Œë“  ë‹¤ìŒ ì˜¤ë¦„ì°¨ìˆœ ì—°ë„ë¥¼ ë§Œë“­ë‹ˆë‹¤.</p>

<p>ë”°ë¼ì„œ, MongoëŠ” ê° ë²”ì£¼ì— ëŒ€í•´ ì—°ë„ë¥¼ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì¸ë±ìŠ¤ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"category"</span><span class="p">:</span> <span class="s">"economics"</span><span class="p">},</span> <span class="p">{</span><span class="s">"year"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"_id"</span><span class="p">:</span><span class="mi">0</span><span class="p">}))</span>
</code></pre></div></div>

<p>MongoëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì»¬ë ‰ì…˜ ìì²´ë¥¼ ê²€ì‚¬í•  í•„ìš”ì—†ì´, ì¸ë±ìŠ¤ì— ì˜í•´ ì»¤ë²„ë©ë‹ˆë‹¤.</p>

<p>ì†ë„í–¥ìƒ ì¸¡ë©´ì—ì„œëŠ” ì•½ê°„ì˜ í–¥ìƒì„ ì–»ì§€ë§Œ, ì»¬ë ‰ì…˜ë³´ë‹¤ í›¨ì”¬ ì ì€ ê³µê°„ì„ ì°¨ì§€í•©ë‹ˆë‹¤.</p>

<p>ì¼ë°˜ì ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ í¬í•¨í•˜ëŠ” ì¸ë±ìŠ¤ë¥¼ ì •ì˜í•˜ë©´ ì„±ëŠ¥ì´ í¬ê²Œ í–¥ìƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="ì¿¼ë¦¬-ì„±ëŠ¥-ë¬¸ì œë¥¼-í•´ê²°í•˜ëŠ”-ëª‡ê°€ì§€-ë°©ë²•">ì¿¼ë¦¬ ì„±ëŠ¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ëª‡ê°€ì§€ ë°©ë²•</h4>

<ul>
  <li>index_information()
    <ul>
      <li>ì»¬ë ‰ì…˜ì— ì–´ë–¤ ì¸ë±ìŠ¤ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>explain()
    <ul>
      <li>MongoDBëŠ” ì£¼ì–´ì§„ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ëŠ” ë°©ë²•ì„ ìì„¸íˆ ì„¤ëª…í•˜ëŠ” ì¿¼ë¦¬ ê³„íšì˜ ì¶œë ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h4 id="example-limiting-our-exploration">Example) Limiting our exploration</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({},</span> <span class="p">[</span><span class="s">"laureates.share"</span><span class="p">]):</span>
  <span class="n">share_is_three</span> <span class="o">=</span> <span class="p">[</span><span class="n">laureate</span><span class="p">[</span><span class="s">'share'</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span> <span class="k">for</span> <span class="n">laureate</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s">"laureates"</span><span class="p">]]</span>
</code></pre></div></div>

<p>ì²«ë²ˆì§¸, ëª¨ë“  ìˆ˜ìƒì— ëŒ€í•´ shareê°€ 3ì¸ ê²½ìš°ë¥¼ í™•ì¸</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">}):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ì´ë¥¼ í†µí•´ 3ìœ¼ë¡œ ë¶„í• ëœ ìˆ˜ìƒ ì •ë³´ë¥¼ ì¸ì‡„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì¶œë ¥í•  ê²½ìš°, ìˆ˜ë§ì€ ì¶œë ¥ì„ ê°€ì§€ê²Œë©ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">},</span> <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ìœ„ì²˜ëŸ¼, ìˆ˜ë§ì€ ì¶œë ¥ì„ ì›ì¹˜ ì•Šì„ ê²½ìš°, limit ì˜µì…˜ì„ í†µí•´, ì¶œë ¥í•˜ê³  ì‹¶ì€ ì–‘ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">},</span> <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ë˜í•œ, skipì„ í†µí•´, ì²˜ìŒë¶€í„° skipìœ¼ë¡œ ì„¤ì •í•œ ìˆ«ìë§Œí¼ ê±´ë„ˆë›°ê³  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">}).</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ìœ„ì²˜ëŸ¼, findì— ì¸ìë¡œ limitë¥¼ ì£¼ì§€ì•Šê³ , ì»¤ì„œì— ì—°ê²°í•´ì„œ ì œí•œì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">}).</span><span class="n">sort</span><span class="p">([(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)]).</span><span class="n">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"{year} {category}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="n">doc</span><span class="p">))</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´, sort, skip, limit ëª¨ë‘ ì»¤ì„œì— ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë‹¨, <strong>find_one</strong>ì— ê²½ìš° ì»¤ì„œì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="simple-sorts-of-sort">Simple sorts of sort</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cursor1</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span><span class="s">"3"</span><span class="p">}).</span><span class="n">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">sort</span><span class="p">([(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">)]))</span>
<span class="n">cursor2</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span><span class="s">"3"</span><span class="p">}).</span><span class="n">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">sort</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">cursor3</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">find</span><span class="p">({</span><span class="s">"laureates.share"</span><span class="p">:</span><span class="s">"3"</span><span class="p">}).</span><span class="n">skip</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">sort</span><span class="p">(</span><span class="s">"year"</span><span class="p">))</span>
</code></pre></div></div>

<p>ìœ„ì˜ 3ì¤„ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="4-aggregation-pipelines-let-the-server-do-it-for-you">4. Aggregation Pipelines: Let the Server Do It For You</h2>

<p><br /></p>

<h4 id="queries-have-implicit-stages">Queries have implicit stages</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span> <span class="s">"USA"</span><span class="p">},</span> <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s">"prizes.year"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span>
				<span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œëŠ” ë‹¨ê³„ë³„ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.</p>

<ol>
  <li>í•„í„°</li>
  <li>ì¶œë ¥ì„ ìœ„í•´ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ì— í•„ìš”í•œ í•„ë“œë¥¼ íˆ¬ì˜</li>
  <li>ê²€ìƒ‰ë˜ëŠ” ë¬¸ì„œì˜ ìˆ˜ë¥¼ ì œí•œ</li>
</ol>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span><span class="s">"USA"</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"prizes.year"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$limit"</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">])</span>
</code></pre></div></div>

<p>ìœ„ì˜ ì½”ë“œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="adding-sort-and-skip-stages">Adding sort and skip stages</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span><span class="s">"USA"</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"prizes.year"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"_id"</span><span class="p">:</span><span class="mi">0</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$sort"</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">"prizes.year"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])},</span>
  <span class="p">{</span><span class="s">"$skip"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"$limit"</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
<span class="p">]))</span>
</code></pre></div></div>

<p>ì •ë ¬ ë° ìŠ¤í‚µë˜í•œ, íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë‹¨ ì •ë ¬ ë‹¨ê³„ì—ì„œ, pymongoëŠ” OrderDictí´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>OrderDict í´ë˜ìŠ¤ëŠ” ì…ë ¥ëœ ìˆœì„œëŒ€ë¡œ í•„ë“œ ë°©í–¥ ìŒì„ ìƒì„±í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="but-can-i-count">But can I count?</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s">"bornCountry"</span><span class="p">:</span><span class="s">"USA"</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$count"</span><span class="p">:</span> <span class="s">"n_USA-born-laureates"</span><span class="p">}</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'n_USA-born-laureates'</span><span class="p">:</span> <span class="mi">269</span><span class="p">}]</span>
</code></pre></div></div>

<p>count ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ì „ ë‹¨ê³„ì—ì„œ ì „ë‹¬ëœ ë¬¸ì„œì˜ ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>í•´ë‹¹ ì§‘ê³„ ì»¬ë ‰ì…˜ì€, <strong>count_documents</strong> ë©”ì„œë“œì™€ ë™ì¼í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="field-paths">Field paths</h4>

<p>ì§‘ê³„ ë‹¨ê³„ëŠ” í•„ë“œ ê²½ë¡œê°€ í‘œí•¨ëœ í‘œí˜„ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>í‘œí˜„ ë°©ì‹
    <ul>
      <li>{field1: <expression1>, ...}</expression1></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"prizes.share"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="p">]).</span><span class="nb">next</span><span class="p">()</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">'5bd3a610053b1704219e19d4'</span><span class="p">),</span>
	<span class="s">'prizes'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'share'</span><span class="p">:</span> <span class="s">'1'</span><span class="p">}]}</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì—ì„œ í‘œí˜„ ê°œì²´ë¥¼ í”„ë¡œì íŠ¸ ë‹¨ê³„ì— ì „ë‹¬í•©ë‹ˆë‹¤.</p>

<p>ê°œì²´ì— â€˜prizes.shareâ€™ë¼ëŠ” í•˜ë‚˜ì˜ í‚¤ê°€ ìˆìœ¼ë©´ í‘œí˜„ì‹ ê°’ì€ 1 ì…ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_prizes"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$size"</span><span class="p">:</span> <span class="s">"$prizes"</span><span class="p">}}}</span>
<span class="p">]).</span><span class="nb">next</span><span class="p">()</span>
</code></pre></div></div>

<p>ëŒ€ì¡°ì ìœ¼ë¡œ, ìœ„ì˜ ì½”ë“œëŠ” â€œn_prizesâ€ë¼ê³  í•˜ëŠ” í•„ë“œì— íˆ¬ì˜í•©ë‹ˆë‹¤.</p>

<ul>
  <li>{â€œ$sizeâ€: â€œ$prizesâ€} ì´ë¼ëŠ” í‘œí˜„ì‹ì˜ ê°’ì„ ì‚¬ìš©</li>
  <li>field path : $prizes</li>
</ul>

<p>íŒŒì´í”„ë¼ì¸ì— ì˜í•´ í•´ë‹¹ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬ëœ ê° ë¬¸ì„œì— ëŒ€í•œ prizes í•„ë“œì˜ ê°’ì„ ì·¨í•©ë‹ˆë‹¤.</p>

<p>ì´ë¥¼ ì´ìš©í•´ì„œ, ì§‘ê³„ ì¤‘ ìƒˆ í•„ë“œë¥¼ ë§Œë“¤ê±°ë‚˜, ì´ì „ í•„ë“œë¥¼ ë®ì–´ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="operator-expression">Operator expression</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_prizes"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$size"</span><span class="p">:</span><span class="s">"$prizes"</span><span class="p">}}}</span>
<span class="p">]).</span><span class="nb">next</span><span class="p">()</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">'5bd3a610053b1704219e19d4'</span><span class="p">),</span>
<span class="s">'n_prizes'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì„œ ë˜ ë‹¤ë¥¸ ìƒˆë¡œìš´ ê°œë…ì€ ì—°ì‚°ìë¥¼ í•¨ìˆ˜ë¡œ ì·¨ê¸‰í•˜ëŠ” ì—°ì‚°ì í‘œí˜„ì‹ì…ë‹ˆë‹¤.</p>

<p>í‘œí˜„ì‹ì€ í•˜ë‚˜ ì´ìƒì˜ ì¸ìˆ˜ì— ì—°ì‚°ìë¥¼ ì ìš©í•˜ê³ , ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.</p>

<ul>
  <li>í‘œí˜„ì‹ : {â€œ$sizeâ€: â€œ$prizesâ€}</li>
  <li>filed path : $prizes</li>
</ul>

<p>ë”°ë¼ì„œ í‘œí˜„ì‹ ê°œì²´ëŠ” n-prizes í•„ë“œë¥¼ í• ë‹¹í•©ë‹ˆë‹¤. (í¸ì˜ìƒ í•˜ë‚˜ì˜ ë§¤ê°œë³€ìˆ˜ë§Œ ìˆì–´ì„œ ëŒ€ê´„í˜¸ ìƒëµ)</p>

<p><br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"solo_winner"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$in"</span><span class="p">:[</span><span class="s">"1"</span><span class="p">,</span> <span class="s">"$prizes.share"</span><span class="p">]}}}]).</span><span class="nb">next</span><span class="p">()</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">'5bd3a610053b1704219e19d4'</span><span class="p">),</span>
<span class="s">'solo_winner'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
</code></pre></div></div>

<p>ì¿¼ë¦¬ í•„í„°ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë§ì€ ì—°ì‚°ìì—ëŠ” ì§‘ê³„ì— í•´ë‹¹í•˜ëŠ” ì—°ì‚°ìê°€ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="implementing-distinct">Implementing .distinct()</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">list_1</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">list_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="s">"_id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span> <span class="s">"$bornCountry"</span><span class="p">}}])]</span>
<span class="nb">set</span><span class="p">(</span><span class="n">list_2</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="bp">None</span><span class="p">}</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">list_1</span><span class="p">)</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì„œëŠ” $groupë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. groupì€ _id í•„ë“œë¥¼ ë§¤í•‘í•´ì•¼ í•˜ëŠ” í‘œí˜„ì‹ ê°œì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>ëª¨ë“  MongoDB ë¬¸ì„œì˜ ê²½ìš° _id í•„ë“œëŠ” ê³ ìœ  í•´ì•¼í•©ë‹ˆë‹¤.</p>

<p>ê·¸ë£¹ ë‹¨ê³„ì— ì„ í–‰í•˜ëŠ” ë§¤ì¹˜ ë‹¨ê³„ê°€ ì—†ê¸° ë•Œë¬¸ì— ëª¨ë“  BornCountry ê°’ì´ ìº¡ì³ë©ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ì—ëŠ” í•„ë“œê°€ ë¬¸ì„œì— ì—†ì„ ë•Œ ë°œìƒí•˜ëŠ” ê°’ì¸ None ì´ í¬í•¨ë©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="how-many-prizes-have-been-awarded-in-total">How many prizes have been awarded in total?</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_prizes"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$size"</span><span class="p">:</span> <span class="s">"$prizes"</span><span class="p">}}},</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"n_prizes_total"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$sum"</span><span class="p">:</span> <span class="s">"$n_prizes"</span><span class="p">}}}</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'_id'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span><span class="s">'n_prizes_total'</span><span class="p">:</span> <span class="mi">941</span><span class="p">}]</span>
</code></pre></div></div>

<p>project ë‹¨ê³„ì™€ group ë‹¨ê³„ì˜ ê²°í•©ì…ë‹ˆë‹¤.</p>

<p>underscore-idëŠ” ëª¨ë“  ë¬¸ì„œì— ëŒ€í•´ Noneìœ¼ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.</p>

<p>ì¦‰, ê·¸ë£¹ ë‹¨ê³„ì—ì„œ í•˜ë‚˜ì˜ ë¬¸ì„œë§Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>

<p>ì´ ë¬¸ì„œ í•˜ë‚˜ëŠ” ìƒˆ í•„ë“œì¸ n_prizes_totalì„ ì—°ì‚°ì í‘œí˜„ì‹ì— ë§¤í•‘í•©ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ì„œ $sum ì€, ê·¸ë£¹ ë‹¨ê³„ì—ì„œ ëˆ„ì‚°ê¸° ì—­í• ì„ í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="sizing-and-summing">Sizing and summing</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_laureates"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$size"</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">},</span> <span class="s">"category"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span><span class="s">"$category"</span><span class="p">,</span> <span class="s">"n_laureates"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$sum"</span> <span class="p">:</span> <span class="s">"$n_laureates"</span><span class="p">}}},</span>
  <span class="p">{</span><span class="s">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_laureates"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'medicine'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">216</span><span class="p">},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'physics'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">210</span><span class="p">},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'chemistry'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">181</span><span class="p">},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'peace'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">133</span><span class="p">},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'literature'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">114</span><span class="p">},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'economics'</span><span class="p">,</span><span class="s">'n_laureates'</span><span class="p">:</span> <span class="mi">81</span><span class="p">}]</span>
</code></pre></div></div>

<p>ê° ë¶„ì•¼ë³„ ìˆ˜ìƒì ìˆ˜ë¥¼ ì›í•œë‹¤ê³  ê°€ì •í•˜ë©´ ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ $size ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬, í•„ë“œë¥¼ íˆ¬ì˜í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>

<p>ì´í›„, ìƒ ë²”ì£¼ë³„ë¡œ, ê·¸ë£¹í™” í•˜ëŠ” ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ì—¬ ë²”ì£¼ë‹¹ ìˆ˜ìƒì ìˆ˜ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì´í›„, n_laureates í•„ë“œë¥¼ ê° ë²”ì£¼ì— ëŒ€í•œ n_laureates ê°’ì˜ í•©ìœ¼ë¡œ ì¬ì„¤ì •í•©ë‹ˆë‹¤.</p>

<p>ì´í›„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="how-to-unwind">How to $unwind</h4>

<p>ìˆ˜ìƒì ë°°ì—´ì˜ ê°œë³„ ìš”ì†Œë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œìš”?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggreagte</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$unwind"</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">"year"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">"category"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">"laureates.surname"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">"laureates.share"</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$limit"</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'year'</span><span class="p">:</span> <span class="s">'2018'</span><span class="p">,</span>
<span class="s">'category'</span><span class="p">:</span> <span class="s">'physics'</span><span class="p">,</span><span class="s">'laureates'</span><span class="p">:</span> <span class="p">{</span><span class="s">'surname'</span><span class="p">:</span> <span class="s">'Ashkin'</span><span class="p">,</span><span class="s">'share'</span><span class="p">:</span> <span class="s">'2'</span><span class="p">}},</span>
<span class="p">{</span><span class="s">'year'</span><span class="p">:</span> <span class="s">'2018'</span><span class="p">,</span>
<span class="s">'category'</span><span class="p">:</span> <span class="s">'physics'</span><span class="p">,</span><span class="s">'laureates'</span><span class="p">:</span> <span class="p">{</span><span class="s">'surname'</span><span class="p">:</span> <span class="s">'Mourou'</span><span class="p">,</span><span class="s">'share'</span><span class="p">:</span> <span class="s">'4'</span><span class="p">}},</span>
<span class="p">{</span><span class="s">'year'</span><span class="p">:</span> <span class="s">'2018'</span><span class="p">,</span>
<span class="s">'category'</span><span class="p">:</span> <span class="s">'physics'</span><span class="p">,</span><span class="s">'laureates'</span><span class="p">:</span> <span class="p">{</span><span class="s">'surname'</span><span class="p">:</span> <span class="s">'Strickland'</span><span class="p">,</span><span class="s">'share'</span><span class="p">:</span> <span class="s">'4'</span><span class="p">}}]</span>
</code></pre></div></div>

<p>ì´ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œëŠ” $unwindë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>ì´ëŠ” ë°°ì—´ ìš”ì†Œë‹¹ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ ë¬¸ì„œë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ì—ì„œ ìš°ë¦¬ëŠ” ì„¸ ê°œì˜ ë¬¸ì„œì— ê±¸ì³ ìˆ˜ìƒì í•„ë“œë¥¼ í’€ì—ˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="renormalization-anyone">Renormalization, anyone?</h4>

<p>unwind ì´í›„ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ì—¬, ë°ì´í„°ë¥¼ ì¬ì••ì¶•í•©ë‹ˆë‹¤.</p>

<p>ë°ì´í„°ë¥¼ ì •ê·œí™”í•˜ê³  ê° ìƒí’ˆì˜ ìˆ˜ìƒì IDë§Œ ì¶”ì í•˜ë ¤ë©´?</p>

<p>ê²°êµ­ ìš°ë¦¬ëŠ” ìˆ˜ìƒì ì»¬ë ‰ì…˜ì—ì„œ ë”ë§ì€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">'$unwind'</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"year"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">"country"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"laureates.id"</span><span class="p">:</span><span class="mi">1</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$concat"</span><span class="p">:</span> <span class="p">[</span><span class="s">"$cateogry"</span><span class="p">,</span> <span class="s">":"</span><span class="p">,</span> <span class="s">"$year"</span><span class="p">]},</span> <span class="s">"laureate_ids"</span><span class="p">:{</span><span class="s">"$addToSet"</span><span class="p">:</span> <span class="s">"$laureates.id"</span><span class="p">}}}</span>
  <span class="p">{</span><span class="s">"$limit"</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'medicine:1901'</span><span class="p">,</span><span class="s">'laureate_ids'</span><span class="p">:</span> <span class="p">[</span><span class="s">'293'</span><span class="p">]},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'peace:1902'</span><span class="p">,</span><span class="s">'laureate_ids'</span><span class="p">:</span> <span class="p">[</span><span class="s">'465'</span><span class="p">,</span><span class="s">'464'</span><span class="p">]},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'physics:1902'</span><span class="p">,</span><span class="s">'laureate_ids'</span><span class="p">:</span> <span class="p">[</span><span class="s">'3'</span><span class="p">,</span><span class="s">'2'</span><span class="p">]},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'peace:1903'</span><span class="p">,</span><span class="s">'laureate_ids'</span><span class="p">:</span> <span class="p">[</span><span class="s">'466'</span><span class="p">]},</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="s">'medicine:1903'</span><span class="p">,</span><span class="s">'laureate_ids'</span><span class="p">:</span> <span class="p">[</span><span class="s">'295'</span><span class="p">]}]</span>
</code></pre></div></div>

<p>ì—¬ê¸°ì—ì„œ ê° ìˆ˜ìƒë³„ ìˆ˜ìƒìì˜ IDëª©ë¡ì„ ì–»ìŠµë‹ˆë‹¤.</p>

<p>ìˆ˜ìƒì ë°°ì—´ì„ í•´ì²´í•œ í›„ ì—°ë„, ë²”ì£¼ ë° ìˆ˜ìƒì IDë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>

<p>ì—°ë„ì™€ ì¹´í…Œê³ ë¦¬ëŠ” í•¨ê»˜ ìƒì„ ì‹ë³„í•©ë‹ˆë‹¤.</p>

<p>ë”°ë¼ì„œ, ì´ëŸ¬í•œ ê°’ì„ ì—°ê²°í•˜ì—¬ ê·¸ë£¹í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ê·¸ë£¹ ë‹¨ê³„ì—ì„œ addToSet ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ìƒí’ˆì— ëŒ€í•œ ìˆ˜ìƒì IDë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="unwind-and-count-em-one-by-one">$unwind and count â€˜em, one by one</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_laureates"</span> <span class="p">:</span> <span class="p">{</span><span class="s">"$size"</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">},</span> <span class="s">"category"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span><span class="s">"$category"</span><span class="p">,</span> <span class="s">"n_laureates"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$sum"</span><span class="p">:</span> <span class="s">"$n_laureates"</span><span class="p">}}},</span>
  <span class="p">{</span><span class="s">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_laureates"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
<span class="p">]))</span>
</code></pre></div></div>

<p>unwind ì—°ì‚°ìë¥¼ ì´í•´í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì´ì „ì—ëŠ” í¬ê¸° ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒë³„ ìˆ˜ìƒì ìˆ˜ë¥¼ ì˜ˆì¸¡í–ˆìŠµë‹ˆë‹¤.</p>

<p>ì´ í”„ë¡œì ì…˜ì€ ê·¸ë£¹ ë‹¨ê³„ì— ì…ë ¥ë˜ì–´ ì¹´í…Œê³ ë¦¬ë³„ ì¹´ìš´íŠ¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$unwind"</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">}</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span><span class="s">"$category"</span><span class="p">,</span> <span class="s">"n_laureates"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}},</span>
  <span class="p">{</span><span class="s">"$sort"</span><span class="p">:</span> <span class="p">{</span><span class="s">"n_laureates"</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}},</span>
<span class="p">]))</span>
</code></pre></div></div>

<p>í¬ê¸°ë¥¼ ì˜ˆì¸¡í•˜ê³ , í•©ì‚°í•˜ëŠ” ëŒ€ì‹  ë¬¸ì„œë¥¼ í’€ê³  ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ì—ì„œ ê·¸ë£¹ ë‹¨ê³„ëŠ” í•´ì œ ë‹¨ê³„ì—ì„œ ì œê³µí•œ ë²”ì£¼ë‹¹ ë¬¸ì„œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="lookup">$lookup</h4>

<p>ì´ ë‹¨ê³„ì—ì„œëŠ” ì™¼ìª½ ì™¸ë¶€ ì¡°ì¸ì´ë¼ê³  í•˜ëŠ” ê²ƒì„ í†µí•´ ë‹¤ë¥¸ ì»¬ë ‰ì…˜ì—ì„œ ë¬¸ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">prizes</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:{</span><span class="s">"category"</span><span class="p">:</span> <span class="s">"economics"</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$unwind"</span><span class="p">:</span> <span class="s">"$laureates"</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"$lookup"</span><span class="p">:</span> <span class="p">{</span><span class="s">"from"</span><span class="p">:</span> <span class="s">"laureates"</span><span class="p">,</span> <span class="s">"foreignField"</span><span class="p">:</span><span class="s">"id"</span><span class="p">,</span>
              <span class="s">"localField"</span><span class="p">:</span><span class="s">"laureates.id"</span><span class="p">,</span> <span class="s">"as"</span><span class="p">:</span><span class="s">"laureate_bios"</span><span class="p">}},</span>
  <span class="p">{</span><span class="s">"$unwind"</span><span class="p">:</span> <span class="s">"$laureate_bios"</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"$group"</span><span class="p">:</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s">"bornCountries"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$addToSet"</span><span class="p">:</span> <span class="s">"$laureate_bios.bornCountry"</span><span class="p">}}}</span>
<span class="p">]))</span>

<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">[{</span><span class="s">'_id'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
<span class="s">'bornCountries'</span><span class="p">:</span> <span class="p">[</span>
<span class="s">'the Netherlands'</span><span class="p">,</span><span class="s">'British West Indies (now Saint Lucia)'</span><span class="p">,</span><span class="s">'Italy'</span><span class="p">,</span>
<span class="s">'Germany (now Poland)'</span><span class="p">,</span><span class="s">'Hungary'</span><span class="p">,</span><span class="s">'Austria'</span><span class="p">,</span><span class="s">'India'</span><span class="p">,</span><span class="s">'USA'</span><span class="p">,</span>
<span class="s">'Canada'</span><span class="p">,</span><span class="s">'British Mandate of Palestine (now Israel)'</span><span class="p">,</span>
<span class="s">'Norway'</span><span class="p">,</span><span class="s">'Russian Empire (now Russia)'</span><span class="p">,</span><span class="s">'Russia'</span><span class="p">,</span><span class="s">'Finland'</span><span class="p">,</span>
<span class="s">'Scotland'</span><span class="p">,</span><span class="s">'France'</span><span class="p">,</span><span class="s">'Sweden'</span><span class="p">,</span><span class="s">'Germany'</span><span class="p">,</span><span class="s">'Russian Empire (now Belarus)'</span><span class="p">,</span>
<span class="s">'United Kingdom'</span><span class="p">,</span><span class="s">'Cyprus'</span>
<span class="p">]}]</span>
</code></pre></div></div>

<p>ê²½ì œ ë¶„ì•¼ ìˆ˜ìƒìì˜ ì¶œìƒ êµ­ê°€ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>

<p>ìƒí’ˆ ì»¬ë ‰ì…˜ì—ì„œ ë¨¼ì € ìˆ˜ìƒì ë°°ì—´ì„ í•´ì œí•©ë‹ˆë‹¤.</p>

<p>ì´ì œ ê° íŒŒì´í”„ë¼ì¸ ë¬¸ì„œì—ëŠ” ë‹¨ì¼ ìˆ˜ìƒì _IDê°€ ìˆìŠµë‹ˆë‹¤.</p>

<p>ê·¸ëŸ° ë‹¤ìŒ id ì— ëŒ€í•´ ë™ì¼í•œ ê°’ì„ ê°€ì§„ ë¬¸ì„œì— ëŒ€í•´ ìˆ˜ìƒì ì»¬ë ‰ì…˜ì„ ì¿¼ë¦¬í•©ë‹ˆë‹¤.</p>

<p>ìš°ë¦¬ê°€ ì°¾ì€ ê°ê°ì— ëŒ€í•´ laureate_biosë¼ëŠ” ë°°ì—´ì— í‘¸ì‰¬í•©ë‹ˆë‹¤.</p>

<p>ë‹¤ìŒìœ¼ë¡œ, ê³ ìœ í•œ ìˆ˜ìƒì bornCountry ê°’ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p>

<p>$addToSet ì—°ì‚°ìì— ë°°ì—´ì´ ì•„ë‹Œ ë‹¨ì¼ BornCountry ê°’ì„ ì œê³µí•˜ë ¤ê³  í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<p>ìœ„ì˜ ê³¼ì •ì„ ì‰½ê²Œí•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</p>

<p>MongoDBëŠ” ì •ê·œí™” ëœ ìŠ¤í‚¤ë§ˆë¥¼ ì ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì¿¼ë¦¬ ë‹¨ìˆœì„±ê³¼ íš¨ìœ¨ì„±ì„ ì§€ì›í•˜ë„ë¡ ì»¬ë ‰ì…˜ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bornCountries</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">distinct</span><span class="p">(</span><span class="s">"bornCountry"</span><span class="p">,</span> <span class="p">{</span><span class="s">"prizes.category"</span><span class="p">:</span> <span class="s">"economist"</span><span class="p">})</span>
</code></pre></div></div>

<p>ìˆ˜ìƒì ì»¬ë ‰ì…˜ì´ ìƒí’ˆ ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ ì •ë³´ë„ ì €ì¥í•˜ë¯€ë¡œ, ìœ„ì˜ ì½”ë“œë¥¼ ì´ìš©í•˜ë©´ ê°„ë‹¨í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="a-somber-project">A somber $project</h4>

<p>ëŒì•„ê°€ì‹  ë…¸ë²¨ìƒ ìˆ˜ìƒìë“¤ì˜ ìƒì¡´ ì—°ìˆ˜ë¥¼ ì•Œê³ ì‹¶ë‹¤ê³  ê°€ì •í•˜ë©´,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s">"died"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$gt"</span><span class="p">:</span> <span class="s">"1700"</span><span class="p">},</span> <span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$gt"</span><span class="p">:</span> <span class="s">"1700"</span><span class="p">}}}</span>
  <span class="p">{</span><span class="s">"project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"died"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span> <span class="s">"$died"</span><span class="p">}},</span>
              <span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span><span class="s">"$born"</span><span class="p">}}}}</span>
<span class="p">]))</span>
</code></pre></div></div>

<p>born ë° died í•„ë“œë¥¼ íˆ¬ì˜í•˜ì—¬ ì´ë¥¼ ê³„ì‚°í•˜ëŠ” íŒŒì´í”„ë¼ì¸ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>MongoDBì—ëŠ” dateFromStringì´ë¼ëŠ” ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´, ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>$matchë¥¼ í†µí•´, ë¹„ì •ìƒì ì¸ ë‚ ì§œë¥¼ ì œê±°í•˜ê³ , 1700ë…„ ì´ìƒì˜ ë°ì´í„°ë§Œ ì¿¼ë¦¬í•©ë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ ì´ë ‡ê²Œ í•  ê²½ìš°, ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ë°, ì¼ë¶€ ìˆ˜ìƒìëŠ” ì¶œìƒë…„ë„ë§Œ ê¸°ë¡ë˜ì–´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="split-and-cond-itionally-correct">split and cond itionally correct</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">{</span><span class="s">"$match"</span><span class="p">:</span> <span class="p">{</span><span class="s">"died"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$gt"</span><span class="p">:</span> <span class="s">"1700"</span><span class="p">},</span> <span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$gt"</span><span class="p">:</span> <span class="s">"1700"</span><span class="p">}}},</span>
  <span class="p">{</span><span class="s">"$addFields"</span><span class="p">:</span> <span class="p">{</span><span class="s">"bornArray"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$split"</span><span class="p">:</span> <span class="p">[</span><span class="s">"$born"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">]},</span>
                <span class="s">"diedArray"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$split"</span><span class="p">:</span> <span class="p">[</span><span class="s">"$died"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">]}}},</span>

<span class="p">{</span><span class="s">"$addFields"</span><span class="p">:</span> <span class="p">{</span><span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$cond"</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span><span class="s">"$in"</span><span class="p">:</span> <span class="p">[</span><span class="s">"00"</span><span class="p">,</span> <span class="s">"$bornArray"</span><span class="p">]},</span>
  <span class="p">{</span><span class="s">"$concat"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"$arrayElemAt"</span><span class="p">:</span> <span class="p">[</span><span class="s">"$bornArray"</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span> <span class="s">"-01-01"</span><span class="p">]}</span>
<span class="p">]}}},</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"died"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span> <span class="s">"$died"</span><span class="p">}},</span>
<span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span> <span class="s">"$born"</span><span class="p">}},</span>
<span class="s">"_id"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>
  <span class="p">])</span>
</code></pre></div></div>

<p>addFields ë‹¨ê³„ë¥¼ í†µí•´, ë‚ ì§œ ë¬¸ìì—´ì˜ í•˜ì´í°ìœ¼ë¡œ ë¶„í• ëœ ìƒˆ ë°°ì—´ í•„ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ê²ƒì„ í†µí•´, ë…„,ì›”,ì¼ì„ ìš”ì†Œë¡œ ê°–ëŠ” ë°°ì—´ì„ ê°€ì§€ê²Œë©ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ì„œ addFieldsë¥¼ ì“°ëŠ”ì´ìœ ëŠ”, íŒŒì´í”„ë¼ì¸ì— ì „ë‹¬í•˜ë ¤ëŠ” ë‹¤ë¥¸ ëª¨ë“  í•„ë“œë¥¼ ì§€ì •í•  í•„ìš”ê°€ ì—†ì–´ì„œ ì…ë‹ˆë‹¤.</p>

<p>ì´í›„, born í•„ë“œë¥¼ ë‹¤ì‹œ ì‘ì„±í•©ë‹ˆë‹¤.  ì—¬ê¸°ì„œ $condëŠ” ì‚¼í•­ ì—°ì‚°ìì…ë‹ˆë‹¤.</p>

<p>ë§Œì•½ ì¶œìƒ ì›”ì¼ì´ ê¸°ë¡ë˜ì–´ìˆì§€ ì•Šì•„ì„œ, 00ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ìˆë‹¤ë©´, ì´ë¥¼ -01-01ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.</p>

<p>ì´ë¥¼ í†µí•´ ìƒì¡´ì—°ìˆ˜ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h4 id="a-bucket-list">A $bucket list</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">docs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">laureates</span><span class="p">.</span><span class="n">aggregate</span><span class="p">([</span>
  <span class="p">...,{</span>
  <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"died"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span><span class="s">"$died"</span><span class="p">}},</span>
               <span class="s">"born"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$dateFromString"</span><span class="p">:</span> <span class="p">{</span><span class="s">"dateString"</span><span class="p">:</span> <span class="s">"$born"</span><span class="p">}}}},</span>
    <span class="p">{</span><span class="s">"$project"</span><span class="p">:</span> <span class="p">{</span><span class="s">"years"</span><span class="p">:{</span><span class="s">"$floor"</span><span class="p">:</span> <span class="p">{</span><span class="s">"$divide"</span><span class="p">:[</span>
      <span class="p">{</span><span class="s">"$subtract"</span><span class="p">:</span> <span class="p">[</span><span class="s">"$died"</span><span class="p">,</span><span class="s">"$born"</span><span class="p">]},</span>
      <span class="mi">31557600000</span> <span class="c1"># 1000 * 60 * 60 * 24 * 365.25
</span>    <span class="p">]}}}},</span>
    <span class="p">{</span><span class="s">"$bucket"</span><span class="p">:</span> <span class="p">{</span><span class="s">"groupBy"</span><span class="p">:</span> <span class="s">"$years"</span><span class="p">,</span><span class="s">"boundaries"</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">10</span><span class="p">))}}}</span>
<span class="p">]))</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="p">[</span><span class="n">output</span><span class="p">]</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span><span class="s">'count'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span><span class="s">'count'</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span><span class="s">'count'</span><span class="p">:</span> <span class="mi">21</span><span class="p">}</span>
<span class="p">{</span><span class="s">'_id'</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span><span class="s">'count'</span><span class="p">:</span> <span class="mi">87</span><span class="p">}</span>
</code></pre></div></div>

<p>ì´í›„ died ì™€ bornì— ëŒ€í•´ $dateFromStringì„ ì ìš©í•˜ê³ , ì—°ì‚°ì„ì§„í–‰ í›„, íˆ¬ì˜í•©ë‹ˆë‹¤.</p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ $bucket ì—°ì‚°ìë¥¼ ì´ìš©í•˜ëŠ”ë°, ì´ëŠ” ê°’ì„ ì¼ë ¨ì˜ ê²½ê³„ë¡œ ë‚˜ëˆ ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.</p>
:ET